<!DOCTYPE html>
<html>
<meta charset="utf-8">
<title>PANCAN-INFO</title>
<head>
	<link rel="shortcut icon" href="https://icgc.org/files/org_sys/pan.png">
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script type="text/javascript" src="http://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript" src="http://datamaps.github.io/scripts/datamaps.all.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="http://bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="http://localhost/cgi-bin/styletable">
    <link rel="stylesheet" type="text/css" href="http://bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
</head>
<style>
		#headere{
		background-color: #7FB5DA;
		
	}
	#inside{
		line-height: 50px;
		font-size:12px;
	}
</style>
<body>
	 <div id="headere">
		<h1 style="float:left;margin-left:10px;font-size:25px;">PANCAN.INFO</h1>
		<center><div id="inside">
		 <ul class="tab-links">
				<li><a href="#tab1">Sites</a></li>
				<li><a href="#tab2">Uploaders</a></li>
		 </ul>   
		 </div></center>
		 </div>
		 <center><h2>Upload/ Download Progress via GNOS</h2></center>
<div id="fullcontain">
	<div id="center1">
		<div id="tablediv">
			<div id="table">
				<table name="x" id="rounded-corner" summary="">
				<thead>
					<tr>
					<th scope="col"></th>
					<th scope="col"><a href="http://localhost/cgi-bin/de">Heidelberg</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/esaduk">Cambridge</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/brcauk">Hinxton</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/ca">Toronto</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/es">Barcelona</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/sg">Singapore</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/jp">Tokyo</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/all">Total</a></th>
					<th scope="col"><a href="http://localhost/cgi-bin/all">Percentage</a></th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><b>Uploaded</b></td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>
					</tr>
					<tr>
						<td><b>Files Left</b></td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td>   
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<td colspan="10">*Updates every 2 hours </td>
					</tr>
				</tfoot>
				</table>
			</div><!--table-->
		</div><!--tablediv-->
		<div id="chartdiv">
				<div id="charttop">
					<h3 style="margin: 20px;">Proportion of Files Uploaded</h3>
					<div id="radio" style="margin-right:25px;">
						<input type="radio" name="time" id="hr1" onchange="checkr1()">Bi-Hourly
						<input type="radio" name="time" id="day1" onchange="checkr1()">Daily
					</div>
				</div>
				<div id ="chartbottom">
					<h3 style="margin: 20px;">Number of Files Uploaded</h3>
					<div id="radio" style="margin-right:25px;">
						<input type="radio" name="time" id="hr2" onchange="checkr2()">Bi-Hourly
						<input type="radio" name="time" id="day2" onchange="checkr2()">Daily
					</div>
				</div>
		</div><!--chartdiv-->
		<script type="text/javascript">
			function charts(data,label,popup,spot,maxnum,num){
			//creates the line chart
			  var margin = {top: 20, right: 55, bottom: 115, left: 40},
				  width  = 550,
				  height = 200;

			  var x = d3.scale.ordinal()
				  .rangeRoundBands([0, width], .1);

			  var y = d3.scale.linear()
				  .rangeRound([height, 0]);

			  var xAxis = d3.svg.axis()
				  .scale(x)
				  .orient("bottom");

			  var yAxis = d3.svg.axis()
				  .scale(y)
				  .orient("left");

			  var line = d3.svg.line()
				  .interpolate("cardinal")
				  .x(function (d) { return x(d.label) + x.rangeBand() / 2; })
				  .y(function (d) { return y(d.value); });

			  var color = d3.scale.ordinal()
				  .range(["#001c9c","#7F5217","#475003","#9c8305","#d3c47c","#800000","#6C007D"]);

			  var svg = d3.select("#chart"+spot).append("svg")
				  .attr("id","svg"+num)
				  .attr("width",  width  + margin.left + margin.right)
				  .attr("height", height + margin.top  + margin.bottom)
				  .append("g")
				  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			  //reading in the data
			  d3.csv(""+data, function (error, data) {

				var labelVar = 'quarter';
				var varNames = d3.keys(data[0]).filter(function (key) { return key !== labelVar;});
				color.domain(varNames);

				var seriesData = varNames.map(function (name) {
				  return {
					name: name,
					values: data.map(function (d) {
					  return {name: name, label: d[labelVar], value: +d[name]};
					})
				  };
				});

				x.domain(data.map(function (d) { return d.quarter; }));
				
				if (maxnum == 1){
					y.domain([0,1]);
					}
				else {
				y.domain([0,d3.max(seriesData, function (c) { 
					return d3.max(c.values, function (d) { return d.value; });
					})
				  ]);
				}

				svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate(0," + height + ")")
					.call(xAxis)
					.selectAll("text")  
				//.call(wrap, x.rangeBand())
					.style("text-anchor", "end")
					.attr("dx", "-.8em")
					.attr("dy", ".15em")
					.attr("transform", function(d) {
						return "rotate(-70)" 
						});

				svg.append("g")
					.attr("class", "y axis")
					.call(yAxis)
					.append("text")
					.attr("transform", "rotate(-90)")
					.attr("y", 6)
					.attr("dy", ".71em")
					.style("text-anchor", "end")
					.text(""+label);

				var series = svg.selectAll(".series")
					.data(seriesData)
					.enter().append("g")
					.attr("class", "series");

				series.append("path")
				  .attr("class", "line")
				  .attr("d", function (d) { return line(d.values); })
				  .style("stroke", function (d) { return color(d.name); })
				  .style("stroke-width", "4px")
				  .style("fill", "none")

				series.selectAll(".point")
				  .data(function (d) { return d.values; })
				  .enter().append("circle")
				   .attr("class", "point")
				   .attr("cx", function (d) { return x(d.label) + x.rangeBand()/2; })
				   .attr("cy", function (d) { return y(d.value); })
				   .attr("r", "5px")
				   .style("fill", function (d) { return color(d.name); })
				   .style("stroke", "grey")
				   .style("stroke-width", "2px")
				   .on("mouseover", function (d) { showPopover.call(this, d); })
				   .on("mouseout",  function (d) { removePopovers(); })

				var legend = svg.selectAll(".legend")
					.data(varNames.slice().reverse())
				  .enter().append("g")
					.attr("class", "legend")
					.attr("transform", function (d, i) { return "translate(55," + i * 20 + ")"; });

				legend.append("rect")
					.attr("x", width - 10)
					.attr("width", 10)
					.attr("height", 10)
					.style("fill", color)
					.style("stroke", "grey");

				legend.append("text")
					.attr("x", width - 12)
					.attr("y", 6)
					.attr("dy", ".35em")
					.style("text-anchor", "end")
					.text(function (d) { return d; });

				//handles the hover aspect
				function removePopovers () {
				  $('.popover').each(function() {
					$(this).remove();
				  }); 
				}

				function showPopover (d) {
				  $(this).popover({
					title: d.name,
					placement: 'auto top',
					container: 'body',
					trigger: 'manual',
					html : true,
					content: function() { 
					  return "Date: " + d.label + 
							 "<br/>"+popup+ ": " + d3.format(",")(d.value ? d.value: d.y1 - d.y0); }
				  });
				  $(this).popover('show')
				}
				
				//rotates the x-axis label
				function wrap(text, width) {
				  text.each(function() {
					var text = d3.select(this),
						words = text.text().split(/\s+/).reverse(),
						word,
						line = [],
						lineNumber = 0,
						lineHeight = 1.1, // ems
						y = text.attr("y"),
						dy = parseFloat(text.attr("dy")),
						tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
					while (word = words.pop()) {
					  line.push(word);
					  tspan.text(line.join(" "));
					  if (tspan.node().getComputedTextLength() > width) {
						line.pop();
						tspan.text(line.join(" "));
						line = [word];
						tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
				  }
				 }
				});
			   }
			  });
		  }
		 
		//checks which data to graph for the proportion chart
		function checkr1(){
        if (document.getElementById("hr1").checked == true){
        d3.select("#svg1").remove();
        charts("ave_data.csv","Proportion Uploaded %","Proportion Uploaded","top",1,1);
        }
        else if (document.getElementById("day1").checked == true){
        d3.select("#svg1").remove();
        charts("ave_daily.csv","Proportion Uploaded %","Proportion Uploaded","top",1,1);
        };
}
		//checks which data to graph for the upload number chart
	    function checkr2(){
        if (document.getElementById("hr2").checked == true){
        d3.select("#svg2").remove();
        charts("up_data.csv","Uploaded","Uploaded","bottom",0,2);
        }
        else if (document.getElementById("day2").checked == true){
        d3.select("#svg2").remove();
        charts("up_daily.csv","Uploaded","Uploaded","bottom",0,2);
        };
}
			
			//calls function to make the charts
		    charts("ave_data.csv","Proportion Uploaded %","Proportion Uploaded","top",1,1);
		    charts("up_data.csv","Uploaded","Uploaded","bottom",0,2);
			</script>
	</div><!--center1-->
<script type="text/javascript">
      //creates the maps and arcs for all except cambridge
      
      //world with all bubbles
      function whole_world(tab,file,arc){
		  var colors = d3.scale.category10();
		  //basic map config with custom fills, mercator projection
		  var pic = new Datamap({
			  scope: "world",
			  element: document.getElementById(tab),
			  
			  geographyConfig: {
				  popupOnHover: false,
				  highlightOnHover: false,},
			  
			  projection: 'mercator',
			  
			  fills: {
				  defaultFill: "#ABDDA4",
				  red: "#FF0000",
				  blue: "#63AFD0",
				  yellow: "#FFFF00",
				  green: "#00FF00",
				  orange: "90FFFA"}
			})
				  
		  //creates the bubbles
		  var json_data;
		  
		  d3.json(""+file, function(error, json) {
			  json_data = json;
			  pic.bubbles(json_data, {
				 popupTemplate: function(geo, data) {
					 if(data.fillKey !== "blue"){
					  return "<div class='hoverinfo'>"+data.name+"<br/>Uploaded: " + data.uploaded + " Total: " +data.total+ "</div>";	}
					  else{return "<div class='hoverinfo'>"+data.name};
					  }
			  });
		  });
		   
		   //creates the arcs
		   var arc_data1;
			  d3.json(""+arc, function(error, json) {
			  arc_data1 = json;
			   pic.arc(arc_data1,  {strokeWidth: 2, arcSharpness: 0});
			   });
		   
		 
		}
	
	//map for cambridge and hinxton
	function world_uk(tab,filename,arc){
		var zoom = new Datamap({
			element: document.getElementById(tab),
			scope: 'world',
			geographyConfig: {
				popupOnHover: false,
				highlightOnHover: false,},
			setProjection: function(element) {
		
				var projection = d3.geo.mercator()
				.center([1, 52])
				.rotate([4.4, 0])
				.scale(3500)
				.translate([element.offsetWidth / 2, element.offsetHeight / 2]);
		
				var path = d3.geo.path()
				.projection(projection);
		
				return {path: path, projection: projection};
			},
		
			fills: {
				defaultFill: "#ABDDA4",
				red: "#FF0000",
                blue: "#63AFD0",
				yellow: "#FFFF00",
				green: "#00FF00",
				orange: "90FFFA"}
		})

		//creates the bubbles
		var json_data;

		d3.json(""+filename, function(error, json) {
			json_data = json;
			zoom.bubbles(json_data, {
				popupTemplate: function(geo, data) {
					if (data.fillKey !== "blue"){
					return "<div class='hoverinfo'>"+data.name+"<br/>Uploaded: " + data.uploaded + " Total: " +data.total+ "</div>";}
					else {return "<div class='hoverinfo'>"+data.name;};
				}
			});
		});
		
		//creates the arcs
		var arc_data1;
			  d3.json(""+arc, function(error, json) {
			  arc_data1 = json;
			   pic.arc(arc_data1,  {strokeWidth: 2, arcSharpness: 0});
			   });
		

}
</script>
<script type="text/javascript">
	//updates the table
	var table = document.getElementsByName("x");
	var json_data;
	var cell_1 = [];
	var cell_2 = [];
	var val_1 = [];
	var val_2 = [];
	var total_1 = 0;
	var total_2 = 0;

	d3.json("bubble_data.json", function(error, json) {
		json_data = json;
		for (var i = 1,j = 0; i < json_data.length/2 + 2, j < json_data.length; i++, j+=2){
		cell_1[i] = table[0].rows[1].cells[i];
		val_1[i] = cell_1[i].firstChild.data;
		cell_1[i].firstChild.data = ''+json_data[j].uploaded;
		total_1 += json_data[j].uploaded;
		cell_2[i] = table[0].rows[2].cells[i];
		val_2[i] = cell_2[i].firstChild.data;
		var left = json_data[j].total - json_data[j].uploaded;
		cell_2[i].firstChild.data = ''+left;
		total_2 += left;
		}
		
		cell_1[8] = table[0].rows[1].cells[8];
		cell_2[8] = table[0].rows[2].cells[8];
		cell_1[9] = table[0].rows[1].cells[9];
		cell_2[9] = table[0].rows[2].cells[9];
		val_1[8] = cell_1[8].firstChild.data;
		val_2[8] = cell_1[8].firstChild.data;
		val_1[9] = cell_1[9].firstChild.data;
		val_2[9] = cell_1[9].firstChild.data;
		cell_1[8].firstChild.data = ''+total_1;
		cell_2[8].firstChild.data = ''+total_2;
		var ave1 = total_1/(total_1+total_2);
		var ave2 = total_2/(total_1+total_2);
		var all = total_1 + total_2;
		cell_1[9].firstChild.data = ''+total_1+'/'+all+' ('+ave1.toFixed(2)+')';
		cell_2[9].firstChild.data = ''+total_2+'/'+all+' ('+ave2.toFixed(2)+')';
	});
</script>
	<div id="center2">
		<div class="tabs">
			<ul class="tab-links">
				<li class="active"><a href="#tab1">Overview</a></li>
				<li><a href="#tab2">Heidelberg</a></li>
				<li><a href="#tab3">Cambridge</a></li>
				<li><a href="#tab4">Hinxton</a></li>
				<li><a href="#tab5">Toronto</a></li>
				<li><a href="#tab6">Barcelona</a></li>
				<li><a href="#tab7">Singapore</a></li>
				<li><a href="#tab8">Tokyo</a></li>
			</ul>   
			<div class="tab-content">
				<div id="tab1" style="margin: 0px auto;position: relative; max-width: 800px;height: 900px;" class="tab active">
					<p align="center">Overview of all the locations and their current status. Enlarged view of the UK to see Cambridge and Hinxton separately.</p>
					<div id="tab1-map1" style="position: relative; width: 800px; max-height: 500px;" class="tab active"></div>
					<div id="tab1-map2" style="position: relative; max-width: 800px; max-height: 500px;" class="tab active"></div>
				</div>
<script>
	//map with all the bubbles on it
	var colors = d3.scale.category10();
	//basic map config with custom fills, mercator projection
	var pic = new Datamap({
		scope: "world",
		element: document.getElementById("tab1-map1"),
		geographyConfig: {
			popupOnHover: false,
			highlightOnHover: false,},

        projection: 'mercator',

        fills: {defaultFill: "#ABDDA4",
				red: "#FF0000",
                blue: "#63AFD0",
				yellow: "#FFFF00",
				green: "#00FF00",
				orange: "90FFFA"}
				})

	var json_data;

	d3.json("bubble_data.json", function(error, json) {
	json_data = json;
	pic.bubbles(json_data, {
		  popupTemplate: function(geo, data) {
			  return "<div class='hoverinfo'>"+data.name+"<br/>Uploaded: " + data.uploaded + " Total: " +data.total+ "</div>";
		  }
	});
	});
	
	//first zoomed in map on UK
	var zoom = new Datamap({
		element: document.getElementById("tab1-map2"),
		scope: 'world',
		geographyConfig: {
			popupOnHover: false,
			highlightOnHover: false,},
			setProjection: function(element) {
				var projection = d3.geo.mercator()
				.center([1, 52])
				.rotate([4.4, 0])
				.scale(3500)
				.translate([element.offsetWidth / 2, element.offsetHeight / 2]);
				var path = d3.geo.path()
				.projection(projection);
				return {path: path, projection: projection};
			},
		fills: {
			defaultFill: "#ABDDA4",
			red: "#FF0000",
			blue: "#63AFD0",
			yellow: "#FFFF00",
			green: "#00FF00",
			orange: "90FFFA"}
		})
		
d3.json("frontuk.json", function(error, json) {
	json_data = json;
	zoom.bubbles(json_data, {
		  popupTemplate: function(geo, data) {
			  return "<div class='hoverinfo'>"+data.name+"<br/>Uploaded: " + data.uploaded + " Total: " +data.total+ "</div>";
		  }
	});
	});

</script>

				<div id="tab2"  style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>
		 
				<div id="tab3" style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>
		 
				<div id="tab4" style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>
					
				<div id="tab5" style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>

				<div id="tab6" style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>

				<div id="tab7" style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>

				<div id="tab8" style="margin:0px auto;position:relative; width: 800px; height: 500px;"class="tab">
					<p align="center">One loaction means it is uploading to site in same city</p>
				</div>
			</div><!--tab-content-->
		</div><!--tabs-->
	</div><!--center2-->
</div><!--fullcontain-->
<script>
	//global variables to see if clicked or not
	var count2 = 0
	var count3 = 0
	var count4 = 0
	var count5 = 0
	var count6 = 0
	var count7 = 0
	var count8 = 0
	
	$(document).ready(function() {
		$('.tabs .tab-links a').on('click', function(e)  {
        var currentAttrValue = $(this).attr('href');
 
        // Show/Hide Tabs
        $('.tabs ' + currentAttrValue).show().siblings().hide();

		// Picking the right tab/file to show the map
		if (currentAttrValue.slice(1) == 'tab2' && count2 == 0){
		whole_world(currentAttrValue.slice(1),"Heidelberg_bub.json","Heidelberg.json");
		count2 += 1}
		else if (currentAttrValue.slice(1) == 'tab3' && count3 == 0){
		whole_world(currentAttrValue.slice(1),"Cambridge_bub.json","Cambridge.json");
		count3 += 1}
		else if (currentAttrValue.slice(1) == 'tab4' && count4 == 0){
		whole_world(currentAttrValue.slice(1),"Hinxton_bub.json","Hinxton.json");
		count4 += 1}
		else if (currentAttrValue.slice(1) == 'tab5' && count5 == 0){
		whole_world(currentAttrValue.slice(1),"Toronto_bub.json","Toronto.json");
		count5 += 1}
		else if (currentAttrValue.slice(1) == 'tab6' && count6 == 0){
		whole_world(currentAttrValue.slice(1),"Barcelona_bub.json","Barcelona.json");
		count6 += 1}
		else if (currentAttrValue.slice(1) == 'tab7' && count7 == 0){
		whole_world(currentAttrValue.slice(1),"Singapore_bub.json","Singapore.json");
		count7 += 1}
		else if (currentAttrValue.slice(1) == 'tab8' && count8 == 0){
		whole_world(currentAttrValue.slice(1),"Tokyo_bub.json","Tokyo.json");
		count8 += 1}


        // Change/remove current tab to active
        $(this).parent('li').addClass('active').siblings().removeClass('active');
 
        e.preventDefault();        
   });
});
</script>
<img src="http://marsinnovation.com/wp-content/uploads/2012/06/OICR-logo-1024x742.jpeg" class="ribbon" width="200" height="150"/>
</body>
</html>
